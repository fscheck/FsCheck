<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Model-based Testing (Experimental)
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="author" content="Kurt Schelfthout and contributors">

    <link rel="stylesheet" id="theme_link" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/4.3.1/materia/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script> -->

    <link type="text/css" rel="stylesheet" href="https://fscheck.github.io/FsCheck/content/navbar-fixed-left.css" />
    <link type="text/css" rel="stylesheet" href="https://fscheck.github.io/FsCheck/content/fsdocs-default.css" />
    <link type="text/css" rel="stylesheet" href="https://fscheck.github.io/FsCheck/content/fsdocs-custom.css" />
    <script type="text/javascript" src="https://fscheck.github.io/FsCheck/content/fsdocs-tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!-- BEGIN SEARCH BOX: this adds support for the search box -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/JavaScript-autoComplete/1.0.4/auto-complete.css" />
    <!-- END SEARCH BOX: this adds support for the search box -->

</head>

<body>
    <nav class="navbar navbar-expand-md navbar-light bg-secondary fixed-left" id="fsdocs-menu">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarsExampleDefault">
            <a href="https://fscheck.github.io/FsCheck/"><img id="fsdocs-logo" src="https://fscheck.github.io/FsCheck/img/logo.png" alt="FsCheck logo - an inverted A, the mathematical symbol for forall." style="width:150px;margin:10px" /></a>
            <!-- BEGIN SEARCH BOX: this adds support for the search box -->
            <div id="header">
                <div class="searchbox" id="fsdocs-searchbox">
                    <label for="search-by">
                        <i class="fas fa-search"></i>
                    </label>
                    <input data-search-input="" id="search-by" type="search" placeholder="Search..." />
                    <span data-search-clear="">
                        <i class="fas fa-times"></i>
                    </span>
                </div>
            </div>

            <!-- END SEARCH BOX: this adds support for the search box -->
            <ul class="navbar-nav">
                <li class="nav-header">FsCheck</li>
                <li class="nav-item"><a class="nav-link" href="http://nuget.org/packages/FsCheck">Get via NuGet</a></li>
                <li class="nav-item"><a class="nav-link" href="https://github.com/fscheck/FsCheck">Source Code on GitHub</a></li>
                <li class="nav-item"><a class="nav-link" href="https://github.com/fscheck/FsCheck/blob/master/License.txt">License (BSD-3-Clause)</a></li>
                <li class="nav-item"><a class="nav-link" href="https://github.com/fscheck/FsCheck/blob/master/FsCheck Release Notes.md">Release Notes</a></li>
                <li class="nav-item"><a class="nav-link" href="https://fscheck.github.io/FsCheck//users.html">Who is using FsCheck?</a></li>
            
                <li class="nav-header">Getting started</li>
                <li class="nav-item"><a class="nav-link" href="https://fscheck.github.io/FsCheck//QuickStart.html">Quick Start</a></li>
                <li class="nav-item"><a class="nav-link" href="https://fscheck.github.io/FsCheck//LearningResources.html">Learning Resources</a></li>

                <li class="nav-header">Documentation</li>
                <li class="nav-item"><a class="nav-link" href="https://fscheck.github.io/FsCheck//Properties.html">Properties</a></li>
                <li class="nav-item"><a class="nav-link" href="https://fscheck.github.io/FsCheck//TestData.html">Generating test data</a></li>
                <li class="nav-item"><a class="nav-link" href="https://fscheck.github.io/FsCheck//StatefulTesting.html">Model-based testing</a></li>
                <li class="nav-item"><a class="nav-link" href="https://fscheck.github.io/FsCheck//RunningTests.html">Running tests</a></li>
                <li class="nav-item"><a class="nav-link" href="https://fscheck.github.io/FsCheck//TipsAndTricks.html">Tips and Tricks</a></li>
                <li class="nav-item"><a class="nav-link" href="https://fscheck.github.io/FsCheck//StatefulTestingNew.html">Model-based testing vNext (Experimental)</a></li>
                <li class="nav-header">
  API Reference
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://fscheck.github.io/FsCheck/reference/index.html">
    All Namespaces
  </a>
</li>
            </ul>
        </div>
    </nav>
    <div class="container">
        <div class="masthead">
            <h3 class="muted"><a href="https://fscheck.github.io/FsCheck/">FsCheck</a></h3>
        </div>
        <hr />
        <div class="container" id="fsdocs-content">
            <h1><a name="Model-based-Testing-Experimental" class="anchor" href="#Model-based-Testing-Experimental">Model-based Testing (Experimental)</a></h1>
<p>There is also a newer, experimental interface to do model-based testing.</p>
<p><em>Caveat: since this is in the FsCheck.Experimental namespace for now, the rules of semantic versioning do
not apply to this particular part of the API. In other words, minor version releases may break your code.</em></p>
<p>Let's look at the following simple class, which has an artificial bug:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs4', 5)" onmouseover="showTip(event, 'fs4', 5)" class="rt">Counter</span><span class="pn">(</span><span class="o">?</span><span onmouseout="hideTip(event, 'fs5', 6)" onmouseover="showTip(event, 'fs5', 6)" class="fn">initial</span><span class="pn">:</span><span onmouseout="hideTip(event, 'fs6', 7)" onmouseover="showTip(event, 'fs6', 7)" class="vt">int</span><span class="pn">)</span> <span class="o">=</span>
    <span class="k">let</span> <span class="k">mutable</span> <span onmouseout="hideTip(event, 'fs7', 8)" onmouseover="showTip(event, 'fs7', 8)" class="mv">n</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs8', 9)" onmouseover="showTip(event, 'fs8', 9)" class="fn">defaultArg</span> <span onmouseout="hideTip(event, 'fs5', 10)" onmouseover="showTip(event, 'fs5', 10)" class="fn">initial</span> <span class="n">0</span>
    <span class="k">member</span> <span class="id">__</span><span class="pn">.</span><span class="fn">Inc</span><span class="pn">(</span><span class="pn">)</span> <span class="o">=</span> 
        <span class="c">//silly bug</span>
        <span class="k">if</span> <span onmouseout="hideTip(event, 'fs7', 11)" onmouseover="showTip(event, 'fs7', 11)" class="mv">n</span> <span class="o">&lt;=</span> <span class="n">3</span>  <span class="k">then</span> <span onmouseout="hideTip(event, 'fs7', 12)" onmouseover="showTip(event, 'fs7', 12)" class="mv">n</span> <span class="k">&lt;-</span> <span onmouseout="hideTip(event, 'fs7', 13)" onmouseover="showTip(event, 'fs7', 13)" class="mv">n</span> <span class="o">+</span> <span class="n">1</span> <span class="k">else</span> <span onmouseout="hideTip(event, 'fs7', 14)" onmouseover="showTip(event, 'fs7', 14)" class="mv">n</span> <span class="k">&lt;-</span> <span onmouseout="hideTip(event, 'fs7', 15)" onmouseover="showTip(event, 'fs7', 15)" class="mv">n</span> <span class="o">+</span> <span class="n">2</span>
        <span onmouseout="hideTip(event, 'fs7', 16)" onmouseover="showTip(event, 'fs7', 16)" class="mv">n</span>
    <span class="k">member</span> <span onmouseout="hideTip(event, 'fs9', 17)" onmouseover="showTip(event, 'fs9', 17)" class="id">__</span><span class="pn">.</span><span class="fn">Dec</span><span class="pn">(</span><span class="pn">)</span> <span class="o">=</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs7', 18)" onmouseover="showTip(event, 'fs7', 18)" class="mv">n</span> <span class="o">&lt;=</span> <span class="n">0</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs10', 19)" onmouseover="showTip(event, 'fs10', 19)" class="fn">failwithf</span> <span class="s">&quot;Precondition fail&quot;</span> <span class="k">else</span> <span onmouseout="hideTip(event, 'fs7', 20)" onmouseover="showTip(event, 'fs7', 20)" class="mv">n</span> <span class="k">&lt;-</span> <span onmouseout="hideTip(event, 'fs7', 21)" onmouseover="showTip(event, 'fs7', 21)" class="mv">n</span> <span class="o">-</span> <span class="n">1</span><span class="pn">;</span> <span onmouseout="hideTip(event, 'fs7', 22)" onmouseover="showTip(event, 'fs7', 22)" class="mv">n</span>
    <span class="k">member</span> <span onmouseout="hideTip(event, 'fs9', 23)" onmouseover="showTip(event, 'fs9', 23)" class="id">__</span><span class="pn">.</span><span class="fn">Reset</span><span class="pn">(</span><span class="pn">)</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs7', 24)" onmouseover="showTip(event, 'fs7', 24)" class="mv">n</span> <span class="k">&lt;-</span> <span class="n">0</span>
    <span class="k">override</span> <span onmouseout="hideTip(event, 'fs9', 25)" onmouseover="showTip(event, 'fs9', 25)" class="id">__</span><span class="pn">.</span><span class="fn">ToString</span><span class="pn">(</span><span class="pn">)</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs11', 26)" onmouseover="showTip(event, 'fs11', 26)" class="fn">sprintf</span> <span class="s">&quot;Counter = </span><span class="pf">%i</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs7', 27)" onmouseover="showTip(event, 'fs7', 27)" class="mv">n</span>
</code></pre>
<p>As a model to test this class we can use an int value which is an abstraction of the object's internal state. The
idea is that each operation on the class (in this case, Inc, Dec and Reset) affects both the model object and the actual object, and
after each such operation, the model and the actual instance should still be equivalent.</p>
<p>With this idea in mind, you can write a specification of the Counter class using an int model as follows:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs12', 28)" onmouseover="showTip(event, 'fs12', 28)" class="id">spec</span> <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs13', 29)" onmouseover="showTip(event, 'fs13', 29)" class="fn">inc</span> <span class="o">=</span> 
        <span class="pn">{</span> <span class="k">new</span> <span onmouseout="hideTip(event, 'fs14', 30)" onmouseover="showTip(event, 'fs14', 30)" class="rt">Operation</span><span class="pn">&lt;</span><span onmouseout="hideTip(event, 'fs4', 31)" onmouseover="showTip(event, 'fs4', 31)" class="rt">Counter</span><span class="pn">,</span><span onmouseout="hideTip(event, 'fs6', 32)" onmouseover="showTip(event, 'fs6', 32)" class="vt">int</span><span class="pn">&gt;</span><span class="pn">(</span><span class="pn">)</span> <span class="k">with</span>
            <span class="k">member</span> <span class="id">__</span><span class="pn">.</span><span class="fn">Run</span> <span onmouseout="hideTip(event, 'fs15', 33)" onmouseover="showTip(event, 'fs15', 33)" class="fn">m</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs15', 34)" onmouseover="showTip(event, 'fs15', 34)" class="fn">m</span> <span class="o">+</span> <span class="n">1</span>
            <span class="k">member</span> <span onmouseout="hideTip(event, 'fs16', 35)" onmouseover="showTip(event, 'fs16', 35)" class="id">__</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs17', 36)" onmouseover="showTip(event, 'fs17', 36)" class="fn">Check</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs18', 37)" onmouseover="showTip(event, 'fs18', 37)" class="fn">c</span><span class="pn">,</span><span onmouseout="hideTip(event, 'fs15', 38)" onmouseover="showTip(event, 'fs15', 38)" class="fn">m</span><span class="pn">)</span> <span class="o">=</span> 
                <span class="k">let</span> <span onmouseout="hideTip(event, 'fs19', 39)" onmouseover="showTip(event, 'fs19', 39)" class="fn">res</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs18', 40)" onmouseover="showTip(event, 'fs18', 40)" class="fn">c</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs20', 41)" onmouseover="showTip(event, 'fs20', 41)" class="id">Inc</span><span class="pn">(</span><span class="pn">)</span> 
                <span onmouseout="hideTip(event, 'fs15', 42)" onmouseover="showTip(event, 'fs15', 42)" class="fn">m</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs19', 43)" onmouseover="showTip(event, 'fs19', 43)" class="fn">res</span> 
                <span class="o">|@</span> <span onmouseout="hideTip(event, 'fs11', 44)" onmouseover="showTip(event, 'fs11', 44)" class="fn">sprintf</span> <span class="s">&quot;Inc: model = </span><span class="pf">%i</span><span class="s">, actual = </span><span class="pf">%i</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs15', 45)" onmouseover="showTip(event, 'fs15', 45)" class="fn">m</span> <span onmouseout="hideTip(event, 'fs19', 46)" onmouseover="showTip(event, 'fs19', 46)" class="fn">res</span>
            <span class="k">override</span> <span onmouseout="hideTip(event, 'fs16', 47)" onmouseover="showTip(event, 'fs16', 47)" class="id">__</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs21', 48)" onmouseover="showTip(event, 'fs21', 48)" class="fn">ToString</span><span class="pn">(</span><span class="pn">)</span> <span class="o">=</span> <span class="s">&quot;inc&quot;</span><span class="pn">}</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs22', 49)" onmouseover="showTip(event, 'fs22', 49)" class="fn">dec</span> <span class="o">=</span> 
        <span class="pn">{</span> <span class="k">new</span> <span onmouseout="hideTip(event, 'fs14', 50)" onmouseover="showTip(event, 'fs14', 50)" class="rt">Operation</span><span class="pn">&lt;</span><span onmouseout="hideTip(event, 'fs4', 51)" onmouseover="showTip(event, 'fs4', 51)" class="rt">Counter</span><span class="pn">,</span><span onmouseout="hideTip(event, 'fs6', 52)" onmouseover="showTip(event, 'fs6', 52)" class="vt">int</span><span class="pn">&gt;</span><span class="pn">(</span><span class="pn">)</span> <span class="k">with</span>
            <span class="k">member</span> <span class="id">__</span><span class="pn">.</span><span class="fn">Run</span> <span onmouseout="hideTip(event, 'fs15', 53)" onmouseover="showTip(event, 'fs15', 53)" class="fn">m</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs15', 54)" onmouseover="showTip(event, 'fs15', 54)" class="fn">m</span> <span class="o">-</span> <span class="n">1</span>
            <span class="k">override</span> <span onmouseout="hideTip(event, 'fs16', 55)" onmouseover="showTip(event, 'fs16', 55)" class="id">__</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs23', 56)" onmouseover="showTip(event, 'fs23', 56)" class="fn">Pre</span> <span onmouseout="hideTip(event, 'fs15', 57)" onmouseover="showTip(event, 'fs15', 57)" class="fn">m</span> <span class="o">=</span> 
                <span onmouseout="hideTip(event, 'fs15', 58)" onmouseover="showTip(event, 'fs15', 58)" class="fn">m</span> <span class="o">&gt;</span> <span class="n">0</span>
            <span class="k">member</span> <span onmouseout="hideTip(event, 'fs16', 59)" onmouseover="showTip(event, 'fs16', 59)" class="id">__</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs17', 60)" onmouseover="showTip(event, 'fs17', 60)" class="fn">Check</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs18', 61)" onmouseover="showTip(event, 'fs18', 61)" class="fn">c</span><span class="pn">,</span><span onmouseout="hideTip(event, 'fs15', 62)" onmouseover="showTip(event, 'fs15', 62)" class="fn">m</span><span class="pn">)</span> <span class="o">=</span> 
                <span class="k">let</span> <span onmouseout="hideTip(event, 'fs19', 63)" onmouseover="showTip(event, 'fs19', 63)" class="fn">res</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs18', 64)" onmouseover="showTip(event, 'fs18', 64)" class="fn">c</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs24', 65)" onmouseover="showTip(event, 'fs24', 65)" class="id">Dec</span><span class="pn">(</span><span class="pn">)</span>
                <span onmouseout="hideTip(event, 'fs15', 66)" onmouseover="showTip(event, 'fs15', 66)" class="fn">m</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs19', 67)" onmouseover="showTip(event, 'fs19', 67)" class="fn">res</span> 
                <span class="o">|@</span> <span onmouseout="hideTip(event, 'fs11', 68)" onmouseover="showTip(event, 'fs11', 68)" class="fn">sprintf</span> <span class="s">&quot;Dec: model = </span><span class="pf">%i</span><span class="s">, actual = </span><span class="pf">%i</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs15', 69)" onmouseover="showTip(event, 'fs15', 69)" class="fn">m</span> <span onmouseout="hideTip(event, 'fs19', 70)" onmouseover="showTip(event, 'fs19', 70)" class="fn">res</span>
            <span class="k">override</span> <span onmouseout="hideTip(event, 'fs16', 71)" onmouseover="showTip(event, 'fs16', 71)" class="id">__</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs21', 72)" onmouseover="showTip(event, 'fs21', 72)" class="fn">ToString</span><span class="pn">(</span><span class="pn">)</span> <span class="o">=</span> <span class="s">&quot;dec&quot;</span><span class="pn">}</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs25', 73)" onmouseover="showTip(event, 'fs25', 73)" class="fn">create</span> <span onmouseout="hideTip(event, 'fs26', 74)" onmouseover="showTip(event, 'fs26', 74)" class="fn">initialValue</span> <span class="o">=</span> 
        <span class="pn">{</span> <span class="k">new</span> <span onmouseout="hideTip(event, 'fs27', 75)" onmouseover="showTip(event, 'fs27', 75)" class="rt">Setup</span><span class="pn">&lt;</span><span onmouseout="hideTip(event, 'fs4', 76)" onmouseover="showTip(event, 'fs4', 76)" class="rt">Counter</span><span class="pn">,</span><span onmouseout="hideTip(event, 'fs6', 77)" onmouseover="showTip(event, 'fs6', 77)" class="vt">int</span><span class="pn">&gt;</span><span class="pn">(</span><span class="pn">)</span> <span class="k">with</span>
            <span class="k">member</span> <span class="id">__</span><span class="pn">.</span><span class="fn">Actual</span><span class="pn">(</span><span class="pn">)</span> <span class="o">=</span> <span class="k">new</span> <span onmouseout="hideTip(event, 'fs4', 78)" onmouseover="showTip(event, 'fs4', 78)" class="rt">Counter</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs26', 79)" onmouseover="showTip(event, 'fs26', 79)" class="fn">initialValue</span><span class="pn">)</span>
            <span class="k">member</span> <span onmouseout="hideTip(event, 'fs28', 80)" onmouseover="showTip(event, 'fs28', 80)" class="id">__</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs29', 81)" onmouseover="showTip(event, 'fs29', 81)" class="fn">Model</span><span class="pn">(</span><span class="pn">)</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs26', 82)" onmouseover="showTip(event, 'fs26', 82)" class="fn">initialValue</span> <span class="pn">}</span>
    <span class="pn">{</span> <span class="k">new</span> <span onmouseout="hideTip(event, 'fs30', 83)" onmouseover="showTip(event, 'fs30', 83)" class="rt">Machine</span><span class="pn">&lt;</span><span onmouseout="hideTip(event, 'fs4', 84)" onmouseover="showTip(event, 'fs4', 84)" class="rt">Counter</span><span class="pn">,</span><span onmouseout="hideTip(event, 'fs6', 85)" onmouseover="showTip(event, 'fs6', 85)" class="vt">int</span><span class="pn">&gt;</span><span class="pn">(</span><span class="pn">)</span> <span class="k">with</span>
        <span class="k">member</span> <span class="id">__</span><span class="pn">.</span><span class="fn">Setup</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs31', 86)" onmouseover="showTip(event, 'fs31', 86)" class="m">Gen</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs32', 87)" onmouseover="showTip(event, 'fs32', 87)" class="id">choose</span> <span class="pn">(</span><span class="n">0</span><span class="pn">,</span><span class="n">3</span><span class="pn">)</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs31', 88)" onmouseover="showTip(event, 'fs31', 88)" class="m">Gen</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs33', 89)" onmouseover="showTip(event, 'fs33', 89)" class="id">map</span> <span onmouseout="hideTip(event, 'fs25', 90)" onmouseover="showTip(event, 'fs25', 90)" class="fn">create</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs34', 91)" onmouseover="showTip(event, 'fs34', 91)" class="m">Arb</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs35', 92)" onmouseover="showTip(event, 'fs35', 92)" class="id">fromGen</span>
        <span class="k">member</span> <span onmouseout="hideTip(event, 'fs36', 93)" onmouseover="showTip(event, 'fs36', 93)" class="id">__</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs37', 94)" onmouseover="showTip(event, 'fs37', 94)" class="fn">Next</span> <span class="id">_</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs31', 95)" onmouseover="showTip(event, 'fs31', 95)" class="m">Gen</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs38', 96)" onmouseover="showTip(event, 'fs38', 96)" class="id">elements</span> <span class="pn">[</span> <span onmouseout="hideTip(event, 'fs13', 97)" onmouseover="showTip(event, 'fs13', 97)" class="fn">inc</span><span class="pn">;</span> <span onmouseout="hideTip(event, 'fs22', 98)" onmouseover="showTip(event, 'fs22', 98)" class="fn">dec</span> <span class="pn">]</span> <span class="pn">}</span>
</code></pre>
<p>Let's break this down a bit. A specification is put together as an object that is a subtype of the abstract class <code>Machine&lt;'TypeUnderTest,'ModelType&gt;</code>.
What you're actually defining is a state machine which can simultaneously apply operations, or state transitions, to the actual system
under test (in this case, a simple object) and a model of the system under test.</p>
<p>The methods you override on <code>Machine</code> are <code>Setup</code>, <code>Next</code>, and optionally <code>TearDown</code>.</p>
<p><code>Machine.Setup</code> is a property that returns an <code>Arbitrary</code> instance that generates (and optionally shrinks) a <code>Setup&lt;'TypeUnderTest, 'ModelType&gt;</code> object. This in turn has two methods
to override: <code>Actual()</code> which should return a new, fresh instance of the system under test every time it is called, and <code>Model()</code> which should return the corresponding
instance of the model object each time it is called. In the example, there is only one subclass of <code>Setup&lt;'Counter,int&gt;</code> (in more complex cases, there might be more). Our
<code>Setup</code> instance takes as argument the initial counter value, and returns a fresh <code>Counter</code> as the SUT. The model is in this case simply the initial value.</p>
<p><code>Machine.Next</code> is a method that takes a model and generates the possible operations that are possible from the state represented by the model. Each operation
is represented by an <code>Operation</code> subclass.</p>
<p><code>Operation</code> has three methods to override: <code>Run</code>, <code>Check</code> and optionally <code>Pre</code>. <code>Pre</code> takes a model and returns true
if and only if this operation can execute on a model in that state - in other words it checks if the precondition for the operation is satisfied. Note that
<code>Machine.Next</code> can also return a reduced set of operations based on the model, which is more efficient, but the preconditions are checked regardless for each
operation <code>Next</code> generates.</p>
<p><code>Run</code> takes a model and returns the new model which is the result of applying this operation to the model. <code>Check</code> then takes the new model (as returned from <code>Run</code>),
applies the operation to the actual system under test, and checks whether the result of the SUT matches with the model. The return type of <code>Check</code> is Property so
you can use the usual FsCheck <code>Prop</code> methods to implement this method.</p>
<p>In the example above there are only two operations that we're checking: <code>Inc</code> and <code>Dec</code>. The <code>Run</code> methods respectively increase and decrease the model. <code>Check</code>
calls <code>Inc()</code> or <code>Dec()</code> on the <code>Counter</code> instance, and checks that after that the model counter is equal to the real <code>Counter</code>. <code>Dec</code> in addition has a (quite
silly, for demonstration purposes) precondition that the value should be strictly greater than 0 - if we run this machine our <code>Counter</code> throws if we call <code>Dec</code>
so when we run this specification we can check that FsCheck does the right thing here (testing the test library, very meta...)</p>
<p>We also override ToString in each <code>Operation</code> so that counter-examples can be printed.</p>
<p>A specification can be checked as follows:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs39', 99)" onmouseover="showTip(event, 'fs39', 99)" class="rt">Check</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs40', 100)" onmouseover="showTip(event, 'fs40', 100)" class="id">Quick</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs41', 101)" onmouseover="showTip(event, 'fs41', 101)" class="m">StateMachine</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs42', 102)" onmouseover="showTip(event, 'fs42', 102)" class="id">toProperty</span> <span onmouseout="hideTip(event, 'fs12', 103)" onmouseover="showTip(event, 'fs12', 103)" class="id">spec</span><span class="pn">)</span>
</code></pre>
<table class="pre"><tr><td><pre><code>Falsifiable, after 9 tests (6 shrinks) (StdGen (1353442672, 296857775)):
Label of failing property: Inc: model = 5, actual = 6
Original:
(1, Setup Counter)
inc -&gt; 2
inc -&gt; 3
inc -&gt; 4
inc -&gt; 5
inc -&gt; 6
dec -&gt; 5
dec -&gt; 4
dec -&gt; 3
dec -&gt; 2
dec -&gt; 1

Shrunk:
(1, Setup Counter)
inc -&gt; 2
inc -&gt; 3
inc -&gt; 4
inc -&gt; 5</code></pre></td></tr></table>
<p>Notice that not only has FsCheck found our 'bug', it has also produced the minimal sequence of operations that leads to it.</p>
<p>But what has actually happened? Using the generators from the <code>Machine</code> methods, FsCheck tries to generate a random sequence of operations, for example:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="pn">{</span><span class="id">Setup</span> <span class="o">=</span> <span class="pn">(</span><span class="n">0</span><span class="pn">,</span> <span class="id">Setup</span> <span class="id">Counter</span><span class="pn">)</span><span class="pn">;</span>
 <span class="id">Operations</span> <span class="o">=</span>
  <span class="pn">[</span><span class="pn">(</span><span class="id">inc</span><span class="pn">,</span> <span class="n">1</span><span class="pn">)</span><span class="pn">;</span> <span class="pn">(</span><span class="id">dec</span><span class="pn">,</span> <span class="n">0</span><span class="pn">)</span><span class="pn">;</span> <span class="pn">(</span><span class="id">inc</span><span class="pn">,</span> <span class="n">1</span><span class="pn">)</span><span class="pn">;</span> <span class="pn">(</span><span class="id">inc</span><span class="pn">,</span> <span class="n">2</span><span class="pn">)</span><span class="pn">;</span> <span class="pn">(</span><span class="id">inc</span><span class="pn">,</span> <span class="n">3</span><span class="pn">)</span><span class="pn">;</span> <span class="pn">(</span><span class="id">inc</span><span class="pn">,</span> <span class="n">4</span><span class="pn">)</span><span class="pn">;</span> <span class="pn">(</span><span class="id">inc</span><span class="pn">,</span> <span class="n">5</span><span class="pn">)</span><span class="pn">;</span>
   <span class="pn">(</span><span class="id">dec</span><span class="pn">,</span> <span class="n">4</span><span class="pn">)</span><span class="pn">;</span> <span class="pn">(</span><span class="id">dec</span><span class="pn">,</span> <span class="n">3</span><span class="pn">)</span><span class="pn">]</span><span class="pn">;</span>
 <span class="id">TearDown</span> <span class="o">=</span> <span class="id">TearDown</span> <span class="id">Counter</span><span class="pn">;</span><span class="pn">}</span>
</code></pre>
<p>You can read this as a trace of the operations: the counter started off in state <code>0</code>, then using operation <code>inc</code> when to state <code>1</code>, then using operation <code>dec</code>
went to state <code>0</code> and so on.</p>
<p>This sequence is first generated using the model only, i.e. no operations are actually applied to any <code>Counter</code> objects. After generating a full trace, the operations
are actually applied to the system under test, using the <code>Operation.Check</code> methods of the various <code>Operation</code> objects.</p>
<p>If a failing test is found, FsCheck will attempt to remove operations from the sequence of operations, as long as the test still fails. So in the example above,
although the original sequence contains a few superfluous operations, FsCheck normally finds a shorter if not the shortest sequence that leads to the failure.</p>

            <div class="fsdocs-tip" id="fs1">namespace FsCheck</div>
<div class="fsdocs-tip" id="fs2">namespace FsCheck.Experimental</div>
<div class="fsdocs-tip" id="fs3">namespace System</div>
<div class="fsdocs-tip" id="fs4">Multiple items<br />type Counter =<br />&#160;&#160;new : ?initial:int -&gt; Counter<br />&#160;&#160;member Dec : unit -&gt; int<br />&#160;&#160;member Inc : unit -&gt; int<br />&#160;&#160;member Reset : unit -&gt; unit<br />&#160;&#160;override ToString : unit -&gt; string<br /><br />--------------------<br />new : ?initial:int -&gt; Counter</div>
<div class="fsdocs-tip" id="fs5">val initial : int option</div>
<div class="fsdocs-tip" id="fs6">Multiple items<br />val int : value:&#39;T -&gt; int (requires member op_Explicit)<br /><br />--------------------<br />[&lt;Struct&gt;]<br />type int = int32<br /><br />--------------------<br />type int&lt;&#39;Measure&gt; =<br />&#160;&#160;int</div>
<div class="fsdocs-tip" id="fs7">val mutable n : int</div>
<div class="fsdocs-tip" id="fs8">val defaultArg : arg:&#39;T option -&gt; defaultValue:&#39;T -&gt; &#39;T</div>
<div class="fsdocs-tip" id="fs9">val __ : Counter</div>
<div class="fsdocs-tip" id="fs10">val failwithf : format:Printf.StringFormat&lt;&#39;T,&#39;Result&gt; -&gt; &#39;T</div>
<div class="fsdocs-tip" id="fs11">val sprintf : format:Printf.StringFormat&lt;&#39;T&gt; -&gt; &#39;T</div>
<div class="fsdocs-tip" id="fs12">val spec : Machine&lt;Counter,int&gt;</div>
<div class="fsdocs-tip" id="fs13">val inc : Operation&lt;Counter,int&gt;</div>
<div class="fsdocs-tip" id="fs14">Multiple items<br />type Operation&lt;&#39;Actual,&#39;Model&gt; =<br />&#160;&#160;interface IOperation<br />&#160;&#160;new : unit -&gt; Operation&lt;&#39;Actual,&#39;Model&gt;<br />&#160;&#160;abstract member Check : &#39;Actual * &#39;Model -&gt; Property<br />&#160;&#160;abstract member Pre : &#39;Model -&gt; bool + 1 overload<br />&#160;&#160;abstract member Run : &#39;Model -&gt; &#39;Model<br /><br />--------------------<br />new : unit -&gt; Operation&lt;&#39;Actual,&#39;Model&gt;</div>
<div class="fsdocs-tip" id="fs15">val m : int</div>
<div class="fsdocs-tip" id="fs16">val __ : Operation&lt;Counter,int&gt;</div>
<div class="fsdocs-tip" id="fs17">abstract member Operation.Check : &#39;Actual * &#39;Model -&gt; Property</div>
<div class="fsdocs-tip" id="fs18">val c : Counter</div>
<div class="fsdocs-tip" id="fs19">val res : int</div>
<div class="fsdocs-tip" id="fs20">member Counter.Inc : unit -&gt; int</div>
<div class="fsdocs-tip" id="fs21">Object.ToString() : string</div>
<div class="fsdocs-tip" id="fs22">val dec : Operation&lt;Counter,int&gt;</div>
<div class="fsdocs-tip" id="fs23">override Operation.Pre : &#39;Model -&gt; bool</div>
<div class="fsdocs-tip" id="fs24">member Counter.Dec : unit -&gt; int</div>
<div class="fsdocs-tip" id="fs25">val create : (int -&gt; Setup&lt;Counter,int&gt;)</div>
<div class="fsdocs-tip" id="fs26">val initialValue : int</div>
<div class="fsdocs-tip" id="fs27">Multiple items<br />type Setup&lt;&#39;Actual,&#39;Model&gt; =<br />&#160;&#160;new : unit -&gt; Setup&lt;&#39;Actual,&#39;Model&gt;<br />&#160;&#160;abstract member Actual : unit -&gt; &#39;Actual<br />&#160;&#160;abstract member Model : unit -&gt; &#39;Model<br />&#160;&#160;override ToString : unit -&gt; string<br /><br />--------------------<br />new : unit -&gt; Setup&lt;&#39;Actual,&#39;Model&gt;</div>
<div class="fsdocs-tip" id="fs28">val __ : Setup&lt;Counter,int&gt;</div>
<div class="fsdocs-tip" id="fs29">abstract member Setup.Model : unit -&gt; &#39;Model</div>
<div class="fsdocs-tip" id="fs30">Multiple items<br />type Machine&lt;&#39;Actual,&#39;Model&gt; =<br />&#160;&#160;new : maxNumberOfCommands:int -&gt; Machine&lt;&#39;Actual,&#39;Model&gt; + 1 overload<br />&#160;&#160;abstract member Next : &#39;Model -&gt; Gen&lt;Operation&lt;&#39;Actual,&#39;Model&gt;&gt;<br />&#160;&#160;abstract member ShrinkOperations : Operation&lt;&#39;Actual,&#39;Model&gt; list -&gt; seq&lt;Operation&lt;&#39;Actual,&#39;Model&gt; list&gt; + 1 overload<br />&#160;&#160;member MaxNumberOfCommands : int<br />&#160;&#160;abstract member Setup : Arbitrary&lt;Setup&lt;&#39;Actual,&#39;Model&gt;&gt;<br />&#160;&#160;override TearDown : TearDown&lt;&#39;Actual&gt;<br />&#160;&#160;abstract member TearDown : TearDown&lt;&#39;Actual&gt;<br /><br />--------------------<br />new : unit -&gt; Machine&lt;&#39;Actual,&#39;Model&gt;<br />new : maxNumberOfCommands:int -&gt; Machine&lt;&#39;Actual,&#39;Model&gt;</div>
<div class="fsdocs-tip" id="fs31">Multiple items<br />module Gen<br /><br />from FsCheck<br /><br />--------------------<br />type Gen&lt;&#39;a&gt; =<br />&#160;&#160;private | Gen of (int -&gt; StdGen -&gt; &#39;a)<br />&#160;&#160;&#160;&#160;interface IGen<br />&#160;&#160;&#160;&#160;member private Map : f:(&#39;a -&gt; &#39;b) -&gt; Gen&lt;&#39;b&gt;<br />&#160;&#160;&#160;&#160;static member ( &lt;!&gt; ) : f:(&#39;a1 -&gt; &#39;a2) * a:Gen&lt;&#39;a1&gt; -&gt; Gen&lt;&#39;a2&gt;<br />&#160;&#160;&#160;&#160;static member ( &lt;*&gt; ) : f:Gen&lt;(&#39;a1 -&gt; &#39;a2)&gt; * a:Gen&lt;&#39;a1&gt; -&gt; Gen&lt;&#39;a2&gt;<br />&#160;&#160;&#160;&#160;static member ( &gt;&gt;= ) : m:Gen&lt;&#39;a1&gt; * k:(&#39;a1 -&gt; Gen&lt;&#39;a2&gt;) -&gt; Gen&lt;&#39;a2&gt;</div>
<div class="fsdocs-tip" id="fs32">val choose : l:int * h:int -&gt; Gen&lt;int&gt;</div>
<div class="fsdocs-tip" id="fs33">val map : f:(&#39;b -&gt; &#39;c) -&gt; gen:Gen&lt;&#39;b&gt; -&gt; Gen&lt;&#39;c&gt;</div>
<div class="fsdocs-tip" id="fs34">module Arb<br /><br />from FsCheck</div>
<div class="fsdocs-tip" id="fs35">val fromGen : gen:Gen&lt;&#39;Value&gt; -&gt; Arbitrary&lt;&#39;Value&gt;</div>
<div class="fsdocs-tip" id="fs36">val __ : Machine&lt;Counter,int&gt;</div>
<div class="fsdocs-tip" id="fs37">abstract member Machine.Next : &#39;Model -&gt; Gen&lt;Operation&lt;&#39;Actual,&#39;Model&gt;&gt;</div>
<div class="fsdocs-tip" id="fs38">val elements : xs:seq&lt;&#39;b&gt; -&gt; Gen&lt;&#39;b&gt;</div>
<div class="fsdocs-tip" id="fs39">type Check =<br />&#160;&#160;static member All : config:Config * test:Type -&gt; unit + 1 overload<br />&#160;&#160;static member Method : config:Config * methodInfo:MethodInfo * ?target:obj -&gt; unit<br />&#160;&#160;static member One : config:Config * property:&#39;Testable -&gt; unit + 1 overload<br />&#160;&#160;static member Quick : property:&#39;Testable -&gt; unit + 1 overload<br />&#160;&#160;static member QuickAll : test:Type -&gt; unit + 1 overload<br />&#160;&#160;static member QuickThrowOnFailure : property:&#39;Testable -&gt; unit<br />&#160;&#160;static member QuickThrowOnFailureAll : test:Type -&gt; unit + 1 overload<br />&#160;&#160;static member Verbose : property:&#39;Testable -&gt; unit + 1 overload<br />&#160;&#160;static member VerboseAll : test:Type -&gt; unit + 1 overload<br />&#160;&#160;static member VerboseThrowOnFailure : property:&#39;Testable -&gt; unit<br />&#160;&#160;...</div>
<div class="fsdocs-tip" id="fs40">static member Check.Quick : property:&#39;Testable -&gt; unit<br />static member Check.Quick : name:string * property:&#39;Testable -&gt; unit</div>
<div class="fsdocs-tip" id="fs41">module StateMachine<br /><br />from FsCheck.Experimental</div>
<div class="fsdocs-tip" id="fs42">val toProperty : spec:Machine&lt;&#39;Actual,&#39;Model&gt; -&gt; Property</div>

        </div>

        <!-- BEGIN SEARCH BOX: this adds support for the search box -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/JavaScript-autoComplete/1.0.4/auto-complete.css" />
        <script type="text/javascript">var fsdocs_search_baseurl = 'https://fscheck.github.io/FsCheck/';</script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.8/lunr.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/JavaScript-autoComplete/1.0.4/auto-complete.min.js"></script>
        <script type="text/javascript" src="https://fscheck.github.io/FsCheck/content/fsdocs-search.js"></script>
        <!-- END SEARCH BOX: this adds support for the search box -->
    </div>
</body>

</html>

